# 观察者模式(发布-订阅模式)

```js
class EventBus() {
  constructor() {
    Object.defineProperty(this, 'handlers', {
      value: {}
    })
    // this.handlers = {}
  }
  // listener 为监听的函数名
  on(eventName, listener) {
    if(!this.handlers[eventName]) {
      this.handlers[eventName] = []
    }
    this.handlers[eventName].push(listener)
  }
  emit(eventName, ...args) {
    let listeners = this.handlers[eventName]
    if (!listeners) return console.warn(`${eventName}事件不存在`)
    for(let listener of listeners) {
      listener(...args)
      // listener.apply(listener, args)
    }
  }
  // listener 为监听的函数名
  off(eventName, listener) {
    let listeners = this.handlers[eventName]
    if (!listeners) return console.warn(`${eventName}事件不存在`)
    if(!listener) {
      delete this.handlers[eventName]
      return
    }
    if (listeners.length) {
      let index = listeners.findIndex(it => it === listener)
      if(~index) {
        listeners.splice(index, 1)
      }
    }
  }
  once(eventName, listener) {
    const onceListener = () => {
      listener()
      this.off(eventName, onceListener)
    }
    this.on(eventName, onceListener)
  }
}
```
