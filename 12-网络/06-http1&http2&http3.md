<!--
 * @Author: yaohebin
 * @Date: 2021-02-01 17:38:24
 * @LastEditTime: 2022-08-17 08:14:15
 * @LastEditors: yaohebin
 * @Description: HTTP1&HTTP2&HTTP3
-->

# HTTP1&HTTP2&HTTP3

> **参考**
>
> [《HTTP》【来源：MDN】](https://developer.mozilla.org/zh-CN/docs/Web/HTTP)
>
> [《HTTP 的发展》【来源：MDN】](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP)
>
> [《一文读懂 HTTP/1HTTP/2HTTP/3》(作者：腾讯技术工程)【来源：知乎】](https://zhuanlan.zhihu.com/p/102561034)
>
> [《Http 协议详解(深入理解)》(作者：有抱负的小狮子)【来源：CSDN】](https://blog.csdn.net/weixin_38087538/article/details/82838762)
>
> [《HTTP 2.0 协议详解》(作者：zqjflash)【来源：CSDN】](https://blog.csdn.net/zqjflash/article/details/50179235)
>
> [《http1.1 相对 http2 有哪些不足》(作者：挥刀北上)【来源：腾讯云开发者社区】](https://cloud.tencent.com/developer/inventory/4316/article/1561342)

## HTTP1.1

## HTTP1.1 的缺陷

- **高延迟 - 对头堵塞**
  - 队头阻塞是指当顺序发送的请求序列中的一个请求因为某种原因被阻塞时，在后面排队的所有请求也一并被阻塞，会导致客户端迟迟收不到数据。
  - 一些处理办法：
    - 将同一页面的资源分散到不同域名下，提升连接上限。虽然能公用一个 TCP 管道，但是在一个管道中同一时刻只能处理一个请求，在当前的请求没有结束之前，其他的请求只能处于阻塞状态。
    - 减少请求数量
    - 内联一些资源：css、base64 图片等
    - 并小文件减少资源数
- **无状态特性 - 阻碍交互**
  - 无状态是指协议对于连接状态没有记忆能力。
  - 纯净的 HTTP 是没有 cookie 等机制的，每一个连接都是一个新的连接。
  - 上一次请求验证了用户名密码，而下一次请求服务器并不知道它与上一条请求有何关联，换句话说就是掉登录态。
- **明文传输 - 不安全性**
  - 传输内容没有加密，中途可能被篡改和劫持。
- **不支持服务端推送**

## SPDY

google 推行的改进版本的 HTTP1.1

- 多路复用 - 解决对头堵塞
  - 允许在一个连接上无限制并发流，因为请求在一个通道上，TCP 效率更高，更少的网络连接，发出更密集的包。
- 头部压缩
  - 使用专门的 HPACK 算法，每次请求和响应只发送差异头部，一般可以打到 50% ~ 90% 的高压缩率。
- 请求优先级
  - 虽然无限的并发流解决了对头堵塞的问题，但是如果带宽受限，客户端可能会因防止堵塞通而阻止请求。在网络通道被非关键资源堵塞时高优先级的请求会被优先处理。
- 服务端推送
  - 可以让服务端主动把资源推动到客户端，当然客户端也有权利选择是否选择接收。
- 提高安全性
  - 支持使用 HTTPS 进行加密传输。

## HTTP2

基于 SPDY，专注于性能，最大的一个目标是在用户和网站间只用一个连接。

- 二进制分帧
  - HTTP2 没有改变 HTTP1 的语义，只是在应用层使用二进制分帧方式传输。因此，也引入了新的通信单位：**帧、消息、流**。
  - 分帧有什么好处？服务器单位时间接收到的请求数变多，可以提高并发数。最重要的是，为多路复用提供了底层支持。
- 多路复用
  - 一个域名对应一个连接，一个流代表了一个完整的请求-响应过程。帧是最小的数据单位，每个帧会标识出该帧属于哪个流，流也就是多个帧组成的数据流。多路复用，就是在一个 TCP 连接中可以存在多个流。

### HTTP2 的缺陷

- TCP 以及 TCP+TLS 建立连接的延时
- TCP 的队头阻塞并没有彻底解决
- 多路复用导致服务器压力上升
- 多路复用容易 Timeout

## HTTP3

> 使用 UDP 协议

- 连接迁移
- 无队头堵塞
- 自定义拥塞控制
- 前向安全和前向纠错
