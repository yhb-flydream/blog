# 浏览器的工作原理

> **参考**
>
> [《渲染页面：浏览器的工作原理 - Web 性能》【来源：MDN】](https://developer.mozilla.org/zh-CN/docs/Web/Performance/How_browsers_work)
>
> [《浏览器的工作原理：新式网络浏览器幕后揭秘》(作者：Tali Garsiel / Paul Irish)【来源：html5rocks】](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/)
>
> [《深入理解浏览器工作原理》(作者：小火柴的蓝色理想)【来源：博客园】](https://www.cnblogs.com/xiaohuochai/p/9174471.html)
>
> [《图解浏览器的基本工作原理》(作者：zhangwang)【来源：知乎】](https://zhuanlan.zhihu.com/p/47407398)
>
> [《Inside look at modern web browser》](https://developers.google.com/web/updates/2018/09/inside-browser-part1)

[TOC]

## 浏览器的多进程架构

### 计算机的核心 CPU 和 GPU

- CPU：Center Processing Unit，同时支持并行、串行操作，需很强通用性处理不同数据类型、要支持复杂通用逻辑判断，需引入大量分支和中断处理，结构异常复杂。
- GPU：Graphics Processing Uint，专为执行图形渲染必须的复杂的数学和几何计算而设计。

### 进程（process）和线程（thread）

当我们启动一个应用，计算机会创建一个进程，操作系统会为进程分配一部分内存，应用的所有状态都会保存在这块内存中，应用也许还会创建多个线程来辅助工作，这些线程可以共享这部分内存中的数据。如果应用关闭，进程会被终结，操作系统会释放相关内存。

一个进程还可以要求操作系统生成另一个进程来执行不同的任务，系统会为新的进程分配独立的内存，两个进程之间可以使用 IPC （Inter Process Communication）进行通信。很多应用都会采用这样的设计，如果一个工作进程反应迟钝，重启这个进程不会影响应用其它进程的工作。

### 浏览器架构

浏览器架构没有统一标准规范，不同浏览器可能使用不同线程或多个不同进程来构建 web。少数线程间通过 `IPC` 通信。

### Chrome 的多进程架构

- 浏览器进程：控制应用程序 chrome 部分，包括地址栏，书签，后退和前进按钮。及处理 Web 浏览器的不可见特权部分，例如网络请求和文件访问
- 渲染进程：控制显示网站的选项卡内的任何内容
- 插件进程：控制网站使用的任何插件，例如 flash。
- GPU 进程：独立于其他进程处理 GPU 任务。它被分成不同的进程，因为 GPU 处理来自多个应用程序的请求并将它们绘制在同表面中。
- 其他进程：浏览器右上角更多 -> 更多工具 -> 任务管理器，查看其他进程，如实用程序网络服务、辅助框架

优点：

- 防一个页面崩溃影响整个浏览器
- 安全性和沙箱：操作系统提供了限制进程权限的方法，因此浏览器可以从某些功能中对某些进程进行沙箱处理。如任意访问文件
- 进程有自己的私有内存空间，可以拥有更多的内存。为了节省内存，Chrome 限制了它可以启动的进程数量。这个限制会因设备的内存和 CPU 功率而异，但当 Chrome 达到限制时，它会在一个进程中开始从同一站点运行多个选项卡

## 导航过程

### 处理输入

### 开始导航

### 读取响应

### 查找渲染进程

### 确认导航

### 额外的步骤

## 渲染进程

### 构建 DOM

### 加载次级资源

### JS 的下载与执行

### 样式计算

### 获取布局

### 绘制

### 合成帧

## 事件处理
