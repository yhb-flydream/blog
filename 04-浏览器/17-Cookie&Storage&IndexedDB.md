# Cookie&Storage&IndexedDB

> **参考**
>
> [《(1.6w 字)浏览器灵魂之问，请问你能接得住几个？ - 第 2 篇: 能不能说一说浏览器的本地存储？各自优劣如何？》(作者：神三元)【来源：掘金】](https://juejin.cn/post/6844904021308735502#heading-13)

## Cookie

Cookie 最开始被设计出来其实并不是来做本地存储的，而是为了弥补 HTTP 在状态管理上的不足。

HTTP 协议是一个无状态协议，客户端向服务器发请求，服务器返回响应，故事就这样结束了，但是下次发请求如何让服务端知道客户端是谁呢？这时候就可以使用 Cookie 来标示用户状态。

Cookie 本质上是服务器在浏览器里面存储的一个很小的文本文件，内部以键值的方式来存储。在同一个域名下发送请求，都会携带相同的 Cookie，服务器拿到 Cookie 可以进行解析，便能拿到客户端的状态。

### Cookie 的缺陷

- 容量缺陷
  - 体积只有 4kb
- 性能缺陷
  - 同一个域名下，某一个地址设置的 Cookie 会在该域名下所有的地址都返回，不管改地址需不需要，并在请求时携带完整的 Cookie，这样随着请求的增多，会造成性能浪费
- 安全缺陷
  - Cookie 是以纯文本形式在浏览器和服务器中传递，很容易被非法用户截获，进行篡改，在 Cookie 的有效期内重新发送给服务器。
  - 另外，在 HttpOnly 为 false 的情况下，Cookie 信息能直接通过 js 脚本来读取。

## localStorage

用于域名下的 **持久化存储**

- 容量
  - 上限 5M
- 只存在于客户端
  - 默认不参与服务器的通信，避免了 Cookie 带来的安全和性能问题
- 接口封装
  - 通过 localStorage 暴露在全局，并通过它的 setItem 和 getItem 等方法进行操作
- 存储的是字符串
  - 存储对象类型数据需要使用 JSON 的 stringify 转换成字符串，取用时使用 parse 来解析成对象

## sessionStorage

用于域名下的 **会话存储**

- 容量
  - 上限 5M
- 只存在于客户端
  - 默认不参与服务器的通信，避免了 Cookie 带来的安全和性能问题
- 接口封装
  - 通过 sessionStorage 暴露在全局，并通过它的 setItem 和 getItem 等方法进行操作
- 存储的是字符串
  - 存储对象类型数据需要使用 JSON 的 stringify 转换成字符串，取用时使用 parse 来解析成对象
- 存储限制
  - 只会在当前页面未关闭的时存储数据，若果关闭当前页面，存储的数据也会被清除

## IndexedDB

运行在浏览器的 **非关系型数据库**，本质上是数据库，理论上没有上限。

- 键值对存储
  - 内部采用对象数据库存放数据，在这个仓库中数据采用键值对的方式来存储
- 异步操作
  - 数据库的读写属于 I/O 操作，浏览器中对异步 I/O 提供了支持
- 受同源策略的显示，无法访问跨域的数据库
