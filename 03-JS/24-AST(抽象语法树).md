<!--
 * @Author: yaohebin
 * @Date: 2021-02-19 11:43:03
 * @LastEditTime: 2022-07-08 16:41:30
 * @LastEditors: yaohebin
 * @Description: AST(抽象语法树)
-->

# AST(抽象语法树)

> **参考**
>
> [《手把手带你入门 AST 抽象语法树》(作者：叫我小明呀)【来源：掘金】](https://juejin.cn/post/6844904035271573511)
>
> [《AST 抽象语法树——最基础的 javascript 重点知识，99%的人根本不了解》(作者：刘羽冲)【来源：思否】](https://segmentfault.com/a/1190000016231512)
>
> [《平庸前端码农之蜕变 — AST》(作者：CodeLittlePrince)【来源：github】](https://github.com/CodeLittlePrince/blog/issues/19)
>
> [《AST 抽象语法树》(作者：Jartto)【来源：Jartto's blog】](http://jartto.wang/2018/11/17/about-ast/)
>
> [AST Explorer【来源：AST Explorer】](https://astexplorer.net/)
>
> [《抽象语法树 AST 介绍》【来源：GOYTH】](http://www.goyth.com/2018/12/23/AST/)
>
> [《聊一聊 Javascript 中的 AST》(作者：Cryptic)【来源：简书】](https://www.jianshu.com/p/32db2f258986)

[TOC]

在计算机科学中，抽象语法树（abstract syntax tree 或者缩写为 AST），或者语法树（syntax tree），是**源代码语法结构的抽象的树状表现形式**，这里特指编程语言的源代码。它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构。

> 之所以说语法是「抽象」的，是因为这里的语法并不会表示出真实语法中出现的每个细节。

AST 不依赖于具体的文法，不依赖于语言的细节，我们将源代码转化为 AST 后，可以对 AST 做很多的操作，包括一些你想不到的操作，这些操作实现了各种各样形形色色的功能，给你带进一个不一样的世界。

- 使用场景
  - IDE 的错误提示、代码格式化、代码高亮、代码补全、关键字匹配
  - 打包工具对代码的处理
    - Babel 编译 ES6 语法
    - css 预处理器
    - 代码压缩
    - eslint
    - pretiier

**抽象语法树其实就是将一类标签转化成通用标识符，从而结构出的一个类似于树形结构的语法树。**

## AST 生成过程

### 词法分析

读取代码（scanner），与定义好的 JavaScript 关键字做比较，生成对应的 Token。同时，它会移除空白符，注释，等。最后，整个代码将被分割进一个 tokens 列表（或者说一维数组）。

当词法分析源代码的时候，它会一个一个字母地读取代码，所以很形象地称之为扫描（scans）；当它遇到空格，操作符，或者特殊符号的时候，它会认为一个话已经完成了。

### 语法分析

也叫解析器，它会将词法分析出来的 tokens 数组转化成树形的表达形式。同时，验证语法，语法如果有错的话，抛出语法错误。

当生成树的时候，解析器会删除一些没必要的标识 tokens（比如不完整的括号），因此 AST 不是 100%与源码匹配的，但是已经能让我们知道如何处理了。说个题外话，解析器 100%覆盖所有代码结构生成树叫做 CST（具体语法树）

## Babel 编译过程

### 解析

> 解析步骤接收代码并输出 AST

- 词法分析
  - 词法分析阶段把字符串形式的代码转换为令牌（tokens）流
- 语法分析
  - 语法分析阶段会把一个令牌流转换成 AST 的形式

### 转换

- 接收 AST 并对其进行递归的树形遍历，在此过程中对节点进行添加、更新及移除等操作。
  - 这是 Babel 或是其他编译器中最复杂的过程，同时也是插件将要介入工作的部分。

### 生成

- 代码生成步骤把最终（经过一系列转换之后）的 AST 转换成字符串形式的代码，同时还会创建源码映射（source maps）。
  - 代码生成其实很简单：深度优先遍历整个 AST，然后构建可以表示转换后代码的字符串。
